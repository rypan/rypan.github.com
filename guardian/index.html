<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="http://d3js.org/d3.v2.js"></script>
	<script type="text/javascript" src="tabletop.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

	<style type="text/css">

	</style>

</head>
<body>

<h1>Connectedness + Transparency = Key to Recovery?</h1>
<p>In exploring facets of the world's economic recovery, I was drawn to public datasets by McKinsey and The World Bank. I started to notice a few things:</p>
<p><b>(1) Stronger economies have a strong Internet ecosystem.</b> McKinsey has an index which measures a country's Internet ecosystem based on their human capital, financial capital, infrastructure, and business environment.</p>
<p><b>(2) Countries with a pervasive black market tend to have a weak Internet ecosystem.</b> If you toggle the impact of the shadow economy, you'll see countries with more than 25% of their GDP driven by the black market fall behind.</p>
<p><b>(3) A transparent economy and a vibrant Internet ecosystem signals a country with economy strength and potential.</b></p>

<div id="navigation">
	<button class='first last' onclick='toggleShadowGDP()'>Toggle impact of the shadow economy</button></div>

	<button class='first last' onclick='toggleGDP()'>Toggle GDP sizing</button></div>
<div id="dataviz"></div>

<script type="text/javascript">

	var dataset = [];
	var w = 0;
	var h = 0;
	var x, y, r, color;
	var shadowToggle = 0;
	var gdpToggle = 1;

	window.onload =	function(){ 
						init() 
					};

	function init(){
		Tabletop.init({key:'0AhncVn-7WCLfdEYtWjdZazNKYVZCZElmMDBKZTdHZnc',
		callback: loadData,
		parseNumbers: true,
		simpleSheet: true});
	}

	function loadData(data){
		dataset = data;
		setupCanvas(dataset);
	}

	function setupCanvas(data){
		// Set size of canvas
		w = 600;
		h = 600;
		var padding = 100;
		var circleRadius = 30;

		// Create canvas at #dataviz div
		var svg = d3.select("#dataviz")
					.append("svg:svg")
					.attr("width",w+padding)
					.attr("height",h+padding);

		x = d3.scale.linear()
			.domain([0,100])
			.range([0,w]);

		console.log(d3.max(data,function(d){return d.vibrancy;}))

		y = d3.scale.linear()
			.domain([0,d3.max(data,function(d){return d.shadownumber;})])
			.range([0,h]);

		console.log(d3.max(data,function(d){return d.shadownumber;}))

		r = d3.scale.linear()
			.domain([d3.min(data,function(d){return d.gdp;}),d3.max(data,function(d){return d.gdp;})])
			.range([10,80]);

		color = d3.scale.linear()
			.domain([-1, 0, 1])
			.range(["#CC333F", "#594F4F","#8A9B0F"]);

		console.log(d3.max(data,function(d){return d.gdp;}))

		// Draw Axis
		svg.append("svg:line")
			.attr("id","x-axis")
			.attr("x1",0)
			.attr("x2",w)
			.attr("y1",h/2)
			.attr("y2",h/2)
			.style("stroke","#ccc");

		svg.append("svg:text")
			.attr("x", w-110)
			.attr("y", h/2)
			.attr("dx", 0)
			.attr("dy", 20)
			.attr("text-anchor","right")
			.attr("style","font-size: 14; font-family: Helvetica Neue, sans-serif; font-weight:bold;")
			.text("Internet Vibrancy")
			.attr("fill","black");

		svg.append("svg:text")
			.attr("id","y-north")
			.attr("x", 50)
			.attr("y", h/2 - 100)
			.attr("dx", 0)
			.attr("dy", 0)
			.attr("text-anchor","left")
			.attr("style","font-size: 25; font-family: 'HelveticaNeue-UltraLight', Helvetica Neue, sans-serif;")
			.text("Transparent Economy")
			.attr("fill","#B0B0B0")
			.attr("opacity",0);

		svg.append("svg:text")
			.attr("id","y-south")
			.attr("x", 50)
			.attr("y", h/2 + 100)
			.attr("dx", 0)
			.attr("dy", 0)
			.attr("text-anchor","left")
			.attr("style","font-size: 25; font-family: 'HelveticaNeue-UltraLight', Helvetica Neue, sans-serif;")
			.text("Significant Shadow Economy")
			.attr("fill","#B0B0B0")
			.attr("opacity",0);

		svg.selectAll("xaxis")
	     .data(x.ticks(10))
	     .enter().append("line")
	     .attr("x1", x)
	     .attr("x2", x)
	     .attr("y1", h/2)
	     .attr("y2", h/2 + 5)
	     .style("stroke", "#ccc");

	    svg.selectAll(".rule")
	     .data(x.ticks(10))
	   	 .enter().append("text")
	     .attr("class", "rule")
	     .attr("x", x)
	     .attr("y", h/2)
	     .attr("dy", -3)
	     .attr("text-anchor", "middle")
	     .attr("style","font-size: 10; font-family: Helvetica Neue, sans-serif; font-weight:normal;")
	     .attr("fill","#080808")
	     .text(String);


		// Draw Circles
		svg.selectAll("circle")
			.data(data)
			.enter().append("svg:circle")
			.attr("fill", function(d){return color(d.gdpvelocity);})
			.attr("id", function(d){return d.country;})
			.attr("r",function(d){return r(d.gdp);})
			.attr("opacity",0.9)
			.attr("cx",0)
			.attr("cy", h/2)
			.on("mouseover", function(d,i){d3.select(this).style("stroke","black"); d3.select(this).style("stroke-width",5); console.log(d); console.log(i); showLabel(d,i,d3.mouse(this));})
			.on("mousemove", function(d,i){moveLabel(d,i,d3.mouse(this));})
			.on("mouseout", function(d,i){d3.select(this).style("stroke","none"); console.log(d); console.log(i); removeLabel(d,i);});

		slideCircle();
		
		function showLabel(data,index,coordinates){

			console.log("showLabel called");
			console.log(data.vibrancy);

			svg.append("svg:text")
			.attr("x", x(data.vibrancy))
			.attr("y", h/2)
			.attr("dx", 0)
			.attr("dy", -40)
			.attr("text-anchor","left")
			.attr("id", "name-" + index)
			.attr("style","font-size: 14; font-family: Helvetica Neue, sans-serif; font-weight:bold;")
			.text(data.country)
			.attr("fill","black");

			console.log(coordinates);

			svg.append("svg:text")
			.attr("x", x(data.vibrancy))
			.attr("y", h/2)
			.attr("dx", 0)
			.attr("dy", -25)
			.attr("text-anchor","left")
			.attr("id", "gdp-" + index)
			.attr("style","font-size: 12; font-family: Helvetica Neue, sans-serif; font-weight:normal;")
			.text(data.gdptext)
			.attr("fill","black");

			svg.append("svg:text")
			.attr("x", x(data.vibrancy))
			.attr("y", h/2)
			.attr("dx", 0)
			.attr("dy", -10)
			.attr("text-anchor","left")
			.attr("id", "shadow-" + index)
			.attr("style","font-size: 12; font-family: Helvetica Neue, sans-serif; font-weight:normal;")
			.text(data.shadow + " is shadow economy")
			.attr("fill","#808080");

		}

		function moveLabel(data,index,coordinates){


			svg.select("#name-"+index)
				.attr("x",coordinates[0])
				.attr("y",coordinates[1]);

			svg.select("#gdp-"+index)
				.attr("x",coordinates[0])
				.attr("y",coordinates[1]);

			svg.select("#shadow-"+index)
				.attr("x",coordinates[0])
				.attr("y",coordinates[1]);


		}

		function removeLabel(data,index){
			svg.select("#name-"+index).remove();
			svg.select("#gdp-"+index).remove();
			svg.select("#shadow-"+index).remove();
	

		}


		// Add Labels



		console.log(x(data[1].vibrancy));


	}

	function toggleShadowGDP(){

		var viz = d3.select("#dataviz");

		console.log("toggleShadowGDP Clicked");

		if (shadowToggle == 0){
			showShadows();
			showYAxis()
			shadowToggle = 1;
		}else{
			hideShadows();
			shadowToggle = 0;
		}

		function showShadows(){
			viz.selectAll("circle")
			.data(dataset)
			.transition()
			  .duration(1000)
			  .attr("cy",function(d){return y(d.shadownumber);});
		}

		function hideShadows(){

			hideYAxis();	

			viz.selectAll("circle")
			.data(dataset)
			.transition()
			  .duration(1000)
			  .attr("cy",h/2);
		}
		
	}

	function toggleGDP(){

		var viz = d3.select("#dataviz");

		console.log("toggleGDP Clicked");

		if (gdpToggle == 0){
			showGDP();
			gdpToggle = 1;
		}else{
			hideGDP();
			gdpToggle = 0;
		}

		function showGDP(){
			viz.selectAll("circle")
			.data(dataset)
			.transition()
			  .duration(1000)
			  .attr("r",function(d){return r(d.gdp);});
		}

		function hideGDP(){
			viz.selectAll("circle")
			.data(dataset)
			.transition()
			  .duration(1000)
			  .attr("r",10);
		}
		
	}

	function showYAxis(){

		var viz = d3.select("#dataviz");

		console.log("ShowYAxis");

		d3.select("#y-north")
			.transition()
			  .delay(500)
			  .duration(1000)
			  .attr("opacity","1");

		d3.select("#y-south")
			.transition()
			  .delay(500)
			  .duration(1000)
			  .attr("opacity","1");

	}

	function hideYAxis(){

		d3.select("#y-north")
			.transition()
			  .delay(500)
			  .duration(1000)
			  .attr("opacity","0");

		d3.select("#y-south")
			.transition()
			  .delay(500)
			  .duration(1000)
			  .attr("opacity","0");
	}

	function slideCircle(){

		var viz = d3.select("#dataviz");
		
		viz.selectAll("circle")
		.data(dataset)
		.transition()
		  .delay(0)
		  .duration(1000)
		  .attr("cx",function(d){return x(d.vibrancy);});
	}



</script>


</body>
</html>